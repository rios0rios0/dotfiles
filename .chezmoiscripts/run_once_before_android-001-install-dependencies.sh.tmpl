#!{{ lookPath "bash" }}

# update the package list
apt update

# =========================================================================================================
# Requirements for this repository to work properly
requirements=(
    "git"
    "curl"
    "zip"               # required for SDKMan
    "unzip"             # required for SDKMan
    "age"               # required for Chezmoi (decrypt files with SSH)
    "sqlite"            # it's for managing ZSH history (https://github.com/larkery/zsh-histdb)
    "vim"               # needed for some operations
    "neovim"            # preferred editor
    "binutils-is-llvm"  # required by Azure CLI
    "bison"             # needed for exa (replacement for 'ls')
    "make"              # required for many things and GVM
    "wget"              # required by 1Password CLI
    "zsh"               # preferred shell
)
apt install --no-install-recommends --yes "${requirements[@]}"
# =========================================================================================================
# Hardware
hardware=(
    "htop"          # it's for monitoring system resources
    "screenfetch"   # it's for displaying system information
)
apt install --no-install-recommends --yes "${hardware[@]}"
# =========================================================================================================
# Utilities
utilities=(
    #"imagemagick"       # it's for image manipulation (convert, identify, etc.) TODO: better to use on Windows?
    "jq"                # it's for parsing JSON
    "bat"               # it's for cat with syntax highlighting (https://github.com/sharkdp/bat)
    "silversearcher-ag" # it's for searching files (https://github.com/ggreer/the_silver_searcher)
    "inotify-tools"     # it's for watching file changes ("inotifywait")
    "dos2unix"          # it's for converting text files between Unix and DOS formats
    "expect"            # it's for automating interactive applications (used in some scripts)
    "which"             # it performs command lookups
    "mlocate"           # it performs file searches (locate and updatedb)
)
apt install --no-install-recommends --yes "${utilities[@]}"
# =========================================================================================================
# Languages
languages=(
    "golang"        # not working/broken via GVM, just native package manager
    "rust"          # needed to compile Azure CLI and exa
    "python"        # needed for Azure CLI (not working/broken via Pyenv, just native package manager)
    "python-pip"    # needed for Azure CLI (not working/broken via Pyenv, just native package manager)
)
apt install --no-install-recommends --yes "${languages[@]}"
# =========================================================================================================
# =========================================================================================================
# https://ohmyz.sh/#install
install_oh_my_zsh() {
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
}

# https://sdkman.io/install/
install_sdkman() {
    curl -s "https://get.sdkman.io" | bash
    source "$HOME/.sdkman/bin/sdkman-init.sh"
    sdk install java
    sdk install gradle
}

# https://github.com/nvm-sh/nvm?tab=readme-ov-file#install--update-script
install_nvm() {
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
    # npm, yarn
}

# https://www.cyberciti.biz/open-source/command-line-hacks/exa-a-modern-replacement-for-ls-written-in-rust-for-linuxunix/
install_exa() {
    if ! command -v exa &> /dev/null; then
        cargo install exa
    else
        echo "'exa' is already installed."
    fi
}

# https://pypi.org/project/azure-cli/
install_azure_cli() {
    pip install azure-cli
}

# https://1password.com/downloads/command-line/
install_1password_cli() {
    if [ ! -f /data/data/com.termux/files/usr/bin/op ]; then
        ARCH="arm64"
        wget "https://cache.agilebits.com/dist/1P/op2/pkg/v2.30.3/op_linux_${ARCH}_v2.30.3.zip" -O op.zip
        unzip -d op op.zip
        mv op/op /data/data/com.termux/files/usr/bin/
        rm -rf op.zip op
        chmod +x /data/data/com.termux/files/usr/bin/op
    else
        echo "1Password CLI is already installed."
    fi
}

install_oh_my_zsh
install_sdkman
install_nvm
install_exa
install_azure_cli
install_1password_cli

# =========================================================================================================
# https://docs.astronvim.com/
configure_neovim() {
    set -e

    if [ ! -d "$HOME/.config/nvim" ]; then
        git clone --depth 1 https://github.com/AstroNvim/template ~/.config/nvim
        rm -rf ~/.config/nvim/.git
        nvim
    else
        echo "'nvim' is already configured."
    fi
}

configure_neovim
# =========================================================================================================
